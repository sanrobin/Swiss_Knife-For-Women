{% extends "base.html" %}

{% block title %}Your Profile - Swiss Knife for Women{% endblock %}

{% block content %}
<section class="profile-header">
    <h1>Your Profile</h1>
    <p>Manage your account and safety settings</p>
</section>

<section class="profile-container">
    <div class="profile-sidebar">
        <div class="profile-avatar">
            <div class="avatar-placeholder">
                <span id="avatar-initials">JD</span>
            </div>
            <button id="change-avatar" class="button small">Change Photo</button>
        </div>
        
        <nav class="profile-nav">
            <ul>
                <li class="active"><a href="#personal-info">Personal Information</a></li>
                <li><a href="#emergency-contacts">Emergency Contacts</a></li>
                <li><a href="#safety-settings">Safety Settings</a></li>
                <li><a href="#account-settings">Account Settings</a></li>
                <li><a href="#privacy">Privacy & Security</a></li>
            </ul>
        </nav>
    </div>
    
    <div class="profile-content">
        <div id="personal-info" class="profile-section active">
            <h2>Personal Information</h2>
            <form id="personal-info-form" class="profile-form">
                <div class="form-row">
                    <div class="form-group half">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" name="first_name" value="">
                    </div>
                    
                    <div class="form-group half">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" name="last_name" value="">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="">
                </div>
                
                <div class="form-group">
                    <label for="phone_number">Phone Number</label>
                    <input type="tel" id="phone_number" name="phone_number" value="">
                </div>
                
                <div class="form-group">
                    <label for="date_of_birth">Date of Birth</label>
                    <input type="date" id="date_of_birth" name="date_of_birth" value="">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="button primary">Save Changes</button>
                </div>
            </form>
        </div>
        
        <div id="emergency-contacts" class="profile-section">
            <h2>Emergency Contacts</h2>
            <p>These people will be contacted in case of emergency</p>
            
            <div id="emergency-contacts-list" class="contacts-list">
                <!-- Contacts will be loaded dynamically -->
                <div class="loading-spinner">Loading your contacts...</div>
            </div>
            
            <button id="add-emergency-contact" class="button primary">Add New Contact</button>
        </div>
        
        <div id="safety-settings" class="profile-section">
            <h2>Safety Settings</h2>
            <form id="safety-settings-form" class="profile-form">
                <div class="form-group toggle">
                    <label for="location_tracking">Location Tracking</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="location_tracking" name="location_tracking" checked>
                        <span class="toggle-slider"></span>
                    </div>
                    <p class="setting-description">Allow the app to track your location for safety features</p>
                </div>
                
                <div class="form-group toggle">
                    <label for="auto_sos">Automatic SOS</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="auto_sos" name="auto_sos">
                        <span class="toggle-slider"></span>
                    </div>
                    <p class="setting-description">Automatically trigger SOS when unusual activity is detected</p>
                </div>
                
                <div class="form-group toggle">
                    <label for="safety_alerts">Safety Alerts</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="safety_alerts" name="safety_alerts" checked>
                        <span class="toggle-slider"></span>
                    </div>
                    <p class="setting-description">Receive alerts about safety concerns in your area</p>
                </div>
                
                <div class="form-group">
                    <label for="check_in_frequency">Check-in Frequency</label>
                    <select id="check_in_frequency" name="check_in_frequency">
                        <option value="30">Every 30 minutes</option>
                        <option value="60" selected>Every hour</option>
                        <option value="120">Every 2 hours</option>
                        <option value="240">Every 4 hours</option>
                        <option value="0">Disabled</option>
                    </select>
                    <p class="setting-description">How often the app will ask you to check in during travel</p>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="button primary">Save Settings</button>
                </div>
            </form>
        </div>
        
        <div id="account-settings" class="profile-section">
            <h2>Account Settings</h2>
            <form id="account-settings-form" class="profile-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="" disabled>
                    <p class="setting-description">Username cannot be changed</p>
                </div>
                
                <div class="form-group">
                    <label for="new_password">New Password</label>
                    <input type="password" id="new_password" name="new_password">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Confirm New Password</label>
                    <input type="password" id="confirm_password" name="confirm_password">
                </div>
                
                <div class="form-group">
                    <label for="current_password">Current Password</label>
                    <input type="password" id="current_password" name="current_password">
                    <p class="setting-description">Required to save changes</p>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="button primary">Update Password</button>
                </div>
            </form>
            
            <div class="danger-zone">
                <h3>Danger Zone</h3>
                <button id="delete-account" class="button danger">Delete Account</button>
                <p class="setting-description">This action cannot be undone</p>
            </div>
        </div>
        
        <div id="privacy" class="profile-section">
            <h2>Privacy & Security</h2>
            <form id="privacy-form" class="profile-form">
                <div class="form-group toggle">
                    <label for="data_sharing">Data Sharing</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="data_sharing" name="data_sharing">
                        <span class="toggle-slider"></span>
                    </div>
                    <p class="setting-description">Share anonymized data to improve safety features</p>
                </div>
                
                <div class="form-group toggle">
                    <label for="two_factor_auth">Two-Factor Authentication</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="two_factor_auth" name="two_factor_auth">
                        <span class="toggle-slider"></span>
                    </div>
                    <p class="setting-description">Add an extra layer of security to your account</p>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="button primary">Save Privacy Settings</button>
                </div>
            </form>
            
            <div class="data-management">
                <h3>Your Data</h3>
                <button id="download-data" class="button secondary">Download Your Data</button>
                <button id="clear-history" class="button secondary">Clear Location History</button>
            </div>
        </div>
    </div>
</section>

<!-- Add Contact Modal -->
<div id="add-contact-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Add Emergency Contact</h2>
        <form id="add-contact-form">
            <div class="form-group">
                <label for="contact-name">Name</label>
                <input type="text" id="contact-name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="contact-relationship">Relationship</label>
                <input type="text" id="contact-relationship" name="relationship" required>
            </div>
            
            <div class="form-group">
                <label for="contact-phone">Phone Number</label>
                <input type="tel" id="contact-phone" name="phone" required>
            </div>
            
            <div class="form-group">
                <label for="contact-email">Email (Optional)</label>
                <input type="email" id="contact-email" name="email">
            </div>
            
            <div class="form-group">
                <button type="submit" class="button primary">Save Contact</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="delete-account-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Delete Account</h2>
        <p>Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently removed.</p>
        <form id="delete-account-form">
            <div class="form-group">
                <label for="delete-password">Enter your password to confirm</label>
                <input type="password" id="delete-password" name="password" required>
            </div>
            
            <div class="form-group">
                <button type="submit" class="button danger">Permanently Delete Account</button>
                <button type="button" class="button secondary cancel-delete">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load user data
        loadUserData();
        
        // Load emergency contacts
        loadEmergencyContacts();
        
        // Tab navigation
        const navLinks = document.querySelectorAll('.profile-nav a');
        const sections = document.querySelectorAll('.profile-section');
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href').substring(1);
                
                // Hide all sections
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                document.getElementById(targetId).classList.add('active');
                
                // Update active nav link
                navLinks.forEach(link => {
                    link.parentElement.classList.remove('active');
                });
                this.parentElement.classList.add('active');
            });
        });
        
        // Modal functionality
        const addContactBtn = document.getElementById('add-emergency-contact');
        const addContactModal = document.getElementById('add-contact-modal');
        const deleteAccountBtn = document.getElementById('delete-account');
        const deleteAccountModal = document.getElementById('delete-account-modal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const cancelDeleteBtn = document.querySelector('.cancel-delete');
        
        if (addContactBtn) {
            addContactBtn.addEventListener('click', function() {
                addContactModal.style.display = 'block';
            });
        }
        
        if (deleteAccountBtn) {
            deleteAccountBtn.addEventListener('click', function() {
                deleteAccountModal.style.display = 'block';
            });
        }
        
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                addContactModal.style.display = 'none';
                deleteAccountModal.style.display = 'none';
            });
        });
        
        if (cancelDeleteBtn) {
            cancelDeleteBtn.addEventListener('click', function() {
                deleteAccountModal.style.display = 'none';
            });
        }
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === addContactModal) {
                addContactModal.style.display = 'none';
            }
            if (event.target === deleteAccountModal) {
                deleteAccountModal.style.display = 'none';
            }
        });
        
        // Form submissions
        const personalInfoForm = document.getElementById('personal-info-form');
        const safetySettingsForm = document.getElementById('safety-settings-form');
        const accountSettingsForm = document.getElementById('account-settings-form');
        const privacyForm = document.getElementById('privacy-form');
        const addContactForm = document.getElementById('add-contact-form');
        const deleteAccountForm = document.getElementById('delete-account-form');
        
        if (personalInfoForm) {
            personalInfoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would save the data to the server
                alert('Personal information updated successfully!');
            });
        }
        
        if (safetySettingsForm) {
            safetySettingsForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would save the settings to the server
                alert('Safety settings updated successfully!');
            });
        }
        
        if (accountSettingsForm) {
            accountSettingsForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                
                if (newPassword !== confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }
                
                // In a real app, this would update the password on the server
                alert('Password updated successfully!');
            });
        }
        
        if (privacyForm) {
            privacyForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would save the privacy settings to the server
                alert('Privacy settings updated successfully!');
            });
        }
        
        if (addContactForm) {
            addContactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would save the contact to the server
                alert('Contact added successfully!');
                addContactModal.style.display = 'none';
                
                // Refresh the contacts list
                loadEmergencyContacts();
            });
        }
        
        if (deleteAccountForm) {
            deleteAccountForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would delete the account on the server
                alert('Account deleted successfully!');
                window.location.href = '/';
            });
        }
        
        // Data management buttons
        const downloadDataBtn = document.getElementById('download-data');
        const clearHistoryBtn = document.getElementById('clear-history');
        
        if (downloadDataBtn) {
            downloadDataBtn.addEventListener('click', function() {
                // In a real app, this would download the user's data
                alert('Your data is being prepared for download. You will receive an email with the download link shortly.');
            });
        }
        
        if (clearHistoryBtn) {
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear your location history? This action cannot be undone.')) {
                    // In a real app, this would clear the location history on the server
                    alert('Location history cleared successfully!');
                }
            });
        }
    });
    
    // Load user data from server
    function loadUserData() {
        // In a real app, this would fetch the user data from the server
        // For now, we'll just use dummy data
        setTimeout(function() {
            document.getElementById('first_name').value = 'Jane';
            document.getElementById('last_name').value = 'Doe';
            document.getElementById('email').value = 'jane.doe@example.com';
            document.getElementById('phone_number').value = '+1 (555) 123-4567';
            document.getElementById('date_of_birth').value = '1990-01-01';
            document.getElementById('username').value = 'janedoe';
            document.getElementById('avatar-initials').textContent = 'JD';
        }, 500);
    }
    
    // Load emergency contacts from server
    function loadEmergencyContacts() {
        const contactsList = document.getElementById('emergency-contacts-list');
        if (!contactsList) return;
        
        // In a real app, this would fetch contacts from the server
        // For now, we'll just show some dummy data
        setTimeout(function() {
            contactsList.innerHTML = `
                <div class="contact-list">
                    <div class="contact-item">
                        <div class="contact-info">
                            <h3>John Doe</h3>
                            <p>Husband</p>
                            <p>+1 (555) 987-6543</p>
                        </div>
                        <div class="contact-actions">
                            <button class="button small edit-contact">Edit</button>
                            <button class="button small danger delete-contact">Delete</button>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-info">
                            <h3>Mary Smith</h3>
                            <p>Sister</p>
                            <p>+1 (555) 456-7890</p>
                        </div>
                        <div class="contact-actions">
                            <button class="button small edit-contact">Edit</button>
                            <button class="button small danger delete-contact">Delete</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners to the edit and delete buttons
            document.querySelectorAll('.edit-contact').forEach(btn => {
                btn.addEventListener('click', function() {
                    const contactName = this.closest('.contact-item').querySelector('h3').textContent;
                    alert(`Edit ${contactName} (This would open the edit form in a real app)`);
                });
            });
            
            document.querySelectorAll('.delete-contact').forEach(btn => {
                btn.addEventListener('click', function() {
                    const contactName = this.closest('.contact-item').querySelector('h3').textContent;
                    if (confirm(`Are you sure you want to delete ${contactName} from your emergency contacts?`)) {
                        // In a real app, this would delete the contact on the server
                        this.closest('.contact-item').remove();
                        alert(`${contactName} has been removed from your emergency contacts.`);
                    }
                });
            });
        }, 1000);
    }
</script>
{% endblock %}

